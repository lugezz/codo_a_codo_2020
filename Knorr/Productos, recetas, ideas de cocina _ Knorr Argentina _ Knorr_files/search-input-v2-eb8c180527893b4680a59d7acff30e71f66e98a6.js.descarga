/* Version=6.6.14,Timestamp=2020-12-24T09:28:36.549Z */define("search-input-v2",["search","commonService","typeahead","animService","analytics"],function(){"use strict";return IEA.module("UI.search-input-v2",function(e,t,a){var r,i,n=null,s=null,c=null,o=null,l=[];_.extend(e,{defaultSettings:{searchWrapper:".c-search-input-v2-form__elements",searchInput:".c-search-input-v2-form__textbox.typeahead",clearSearch:".o-btn--reset",searchButton:".js-search-handler",searchForm:".c-search-input-v2-form",takeoverSearchOverlay:".c-search-input-v2__search-overlay",subBrandEnabled:".c-search-sub-brand__enabled",subBrand:".c-search-sub-brand",placeHolder:".js-search-input-v2-placeholder",searchHeadingTxt:".js-search-input-v2-headingtxt",logoImage:".js-search-input-v2-logo",searchInputSubBrand:".c-search-input-v2__subbrand",subBrandActiveItem:".c-search-sub-brand__item.active",subBrandItem:".c-search-sub-brand__item",subBrandWrapper:".c-search-subbrand__wrapper",subBrandPanel:".c-search-subbrand__panel",isPageLoad:!0,searchInputHeader:".c-search-input-v2__header",searchInputWrapper:".c-search-input-v2__wrapper",predictivSearch:".predictive__search__form__textbox",predictiveSuggestion:".predictive__search__suggestion",predictiveSearchSeaction:".predictive__search__section",predictiveSuggestionOption:".suggestion-list__suggestion",predictiveResultCount:4},events:{"submit form":"_submitForm","click .o-btn--search-handler":"_openModal","click .o-btn--search-close":"_closeModal","click .c-search-sub-brand__enabled":"_selectedSubBrand","click .suggestion-list__suggestion":"_updateSuggestionSubmit","click .predictive__search__form__reset":"_resetPredictiveSearch"},initialize:function(e){this._super(e),n=new IEA.search,s=new IEA.animService,c=new IEA.Analytics,o=new IEA.commonService,this.triggerMethod("init")},render:function(){return this.$el.html(this.template(this.getModelJSON())),!1===this._isEnabled&&(this.enable(),this._isEnabled=!0),this.triggerMethod("render"),this},enable:function(){this.triggerMethod("beforEnable");var e=this,t=e.defaultSettings;e.componentJson=e.getModelJSON(),e.searchData=e.componentJson.searchInputV2,e.subBrandMap=e.searchData.subBrandMap,e.searchWrapper=e.$el.find(t.searchWrapper),e.searchInputField=e.$el.find(t.searchInput),e.clearSearch=t.clearSearch,e.searchButton=t.searchButton,e.searchForm=t.searchForm,e.searchKeyword="",e.inputVal="",e.selectedSubBrand="",e.predictivSearch=t.predictivSearch,e.predictiveSuggestionOption=t.predictiveSuggestionOption,e.isLocalEnv=IEA.currentInstance.config.attributes.localEnv,e.predictiveVar={},e.searchData.subBrandMap&&1<e.searchData.subBrandMap.subBrands.length&&e._onLoadSelectedSubBrand(),e._enableSearchMethods(),e._enablePredictiveSearch(),this.triggerMethod("enable")},_resetPredictiveSearch:function(e){$(this.defaultSettings.predictiveSuggestion).html(""),$(this.defaultSettings.predictiveSearchSeaction).html(""),$(this.defaultSettings.predictiveSuggestion).addClass("hide"),$(this.defaultSettings.predictiveSearchSeaction).addClass("hide"),e&&($(this.defaultSettings.predictivSearch).val(""),s.closeOverlay(this.defaultSettings.takeoverSearchOverlay)),this._setOverlayTabbing()},_updateSuggestionSubmit:function(e){e=$(e.currentTarget).text().trim();$(this.predictivSearch).val(e),$(this.searchForm).submit()},onMatchMobile:function(){this.defaultSettings.predictiveResultCount=3},onMatchTablet:function(){this.defaultSettings.predictiveResultCount=4},_enablePredictiveSearch:function(){var t=this;$(".predictive__search__form__textbox").on("input",_.debounce(function(){$.proxy(t._predictiveSearch(),t)},500)),$(document).keyup(function(e){"Escape"===e.key&&t._resetPredictiveSearch(!0)})},_predictiveSearch:function(e){var t=this,a=$(t.predictivSearch).val().trim();t.predictiveVar={},t.predictiveVar.inputvalue=a,t._resetPredictiveSearch(!1),a.length>=t.searchData.minCharToTriggerAutoSuggest&&(t._abortRunningPredictiveAjax(),t._predictiveSearchSuggestion(),t._predictiveSearchContent(a))},_abortRunningPredictiveAjax:function(e){l.length&&(_.each(l,function(e,t){e.abort()}),l=[],this.predictiveVar.predictiveCallBack=0)},_predictiveSearchSuggestion:function(){var t=this,e={ajaxType:"GET"};e.header={brand:t.searchData.brandName,locale:t.searchData.market,"Content-Type":"application/json"},t.searchData.isExternal&&(e.header["external-contents"]="recipe"),e.servletUrl=t.searchData.searchSuggestionHandler+"?q="+encodeURIComponent(t.predictiveVar.inputvalue)+"&Locale="+t.searchData.market+"&BrandName="+t.searchData.brandName,e.onCompleteCallback=function(e){e&&t._predictiveSuggestionTemplate(e)},e.onErrorCallback=function(e){};e=o.ajaxDataRequestXhr(e);l.push(e)},_predictiveSuggestionTemplate:function(e){var t=this,a={},r=[];if(e){for(var i,n,s=0;s<t.searchData.autoSuggestResultCount;s++)e[s]&&(i={},n=new RegExp(t.predictiveVar.inputvalue,"ig"),i.text=e[s].replace(n,"<span>"+t.predictiveVar.inputvalue+"</span>"),i.value=e[s],r[s]=i);a.data=r,a.SuggestionHeading=t.searchData.searchHeadingText,t.predictiveVar.noSuggestionResult=!e.length;a=t.getTemplate("search-input-predictive-suggestion","partials/search-input-predictive-suggestion.hbss")(a);$(t.defaultSettings.predictiveSuggestion).html(a)}this.triggerMethod("afterPredictiveSuggestion")},_predictiveSearchContent:function(){var r,i=this;i.predictiveVar.allContentType=[],i.predictiveVar.contentData=[],i.predictiveVar.clearAllResult=!0,i.predictiveVar.predictiveCallBack=0,_.each(i.searchData.tabContentTypes,function(e,t){"everything"!==e.contentName.toLowerCase()&&""!==e.type&&i.predictiveVar.allContentType.push(e)}),_.each(i.predictiveVar.allContentType,function(t,e){var a=i._getContentAjaxOption(t);a.onCompleteCallback=function(e){i._showPredictiveSearchResult(e,t,"success")},a.onErrorCallback=function(e){i._showPredictiveSearchResult(e,t,"error")},r=o.ajaxDataRequestXhr(a),l.push(r)})},_showPredictiveSearchResult:function(e,t,a){var r=this,i="";r.predictiveVar.predictiveCallBack++,this.triggerMethod("predictiveContentRender"),"success"!==a||_.isEmpty(e)?r.predictiveVar.contentData[t.contentName]="":r.predictiveVar.contentData[t.contentName]=r._predictiveContentRender(e,t),r.predictiveVar.allContentType.length===r.predictiveVar.predictiveCallBack&&(r.predictiveVar.clearAllResult?(t=r.searchData.noResultMessage+" '"+r.predictiveVar.inputvalue+"'",$(".suggestion-list__title span").html(t),r.predictiveVar.noSuggestionResult||$(".suggestion-list__subtitle span").html(r.searchData.noResultSuggestion)):(_.each(r.predictiveVar.allContentType,function(e,t){i+=r.predictiveVar.contentData[e.contentName]}),$(r.defaultSettings.predictiveSearchSeaction).html(i),setTimeout($.proxy(r._setOverlayTabbing,r),200)),$(r.defaultSettings.predictiveSuggestion).removeClass("hide"),$(r.defaultSettings.predictiveSearchSeaction).removeClass("hide"),this.triggerMethod("afterPredictiveContent"))},_predictiveContentRender:function(e,t){var a,r,i=this,n={},s={};return n.contentType=t.contentType,n.contentName=t.contentName.toLowerCase(),n.data=e,s.resultText=i.searchData.resultText,s.viewallText=i.searchData.viewAllTextLabel,s.isMigrationEnabled=i.searchData.isMigrationEnabled,"recipe"===t.contentName.toLowerCase()?(s.viewAllLink=i.searchData.searchResultPage+"?q="+encodeURIComponent(i.predictiveVar.inputvalue)+"&fq=ContentType:"+t.contentName+"&Locale="+i.searchData.locale+"&BrandName="+i.searchData.brandName,0!==(r=i.searchData.isMigrationEnabled?(n.data="object"!=typeof e?JSON.parse(e):e,n.data.hits.total.value):e.data.recipeCount)&&(i.predictiveVar.clearAllResult=!1),r<=i.defaultSettings.predictiveResultCount&&(s.viewallText="",s.viewAllLink="")):(s.viewAllLink=i.searchData.searchResultPage+"?q="+encodeURIComponent(i.predictiveVar.inputvalue)+"&"+t.queryParams+"&Locale="+i.searchData.locale+"&BrandName="+i.searchData.brandName,0!==e.totalResults&&(i.predictiveVar.clearAllResult=!1),e.totalResults<=i.defaultSettings.predictiveResultCount&&(s.viewallText="",s.viewAllLink="")),n.returnData=s,e&&(a=i.getTemplate("search-input-predictive-suggestion","partials/search-input-predictive-content.hbss")(n)),a},_getContentAjaxOption:function(e){var t,a,r=this,i={};return i.locale=r.searchData.locale,i.BrandName=r.searchData.brandName,i.inputvalue=r.predictiveVar.inputvalue,"internal"!==e.type.toLowerCase()?(t=r.searchData.locale,a=r.searchData.isMigrationEnabled?{recipeUrl:r.searchData.recipeUrl,imageRenditions:r.searchData.imageRenditions,imageurl:r.searchData.imageurl,SearchKeyword:r.predictiveVar.inputvalue,size:r.defaultSettings.predictiveResultCount.toString(),from:"1",EnableDidYouMean:!0}:{SearchKeyword:r.predictiveVar.inputvalue,PageSize:r.defaultSettings.predictiveResultCount,PageIndex:1,EnableDidYouMean:!0},i.servletUrl=r.searchData.recipeEndPoint,i.ajaxType=r.isLocalEnv?"GET":"POST",i.data=JSON.stringify(a)):(t=r.searchData.market,i.ajaxType="GET",i.servletUrl=r.searchData.requestServlet+"?q="+encodeURIComponent(r.predictiveVar.inputvalue)+"&"+e.queryParams+"&Locale="+t+"&BrandName="+r.searchData.brandName+"&PageNum=1&ipp="+r.defaultSettings.predictiveResultCount),i.header={brand:r.searchData.brandName,locale:t,"Content-Type":"application/json"},i.contentType=e.contentName,i},_enableSearchMethods:function(){var e=this;$(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(e){var t=$(this);if(t.data("typeahead"))return!0;t.typeahead(t.data())}),0===$(e.searchInputField).parent(".twitter-typeahead").length&&e._renderSuggestions(),$(e.$el.find(e.clearSearch)).on("click",{field:e.defaultSettings.searchInput,wrapper:e.defaultSettings.searchWrapper},n.clearSearchVal)},_submitForm:function(e){var t=this,a=t.$el.find(t.searchForm),r=t.searchInputField,i=a.data("action");if(""!==a.attr("action")||a.hasClass("predictive-search-form"))return a.hasClass("predictive-search-form")&&t._updatePredictivParams(),!0;e.preventDefault(),0<r.typeahead("val").length&&r.typeahead("val").trim().length?(a.attr("action",i),t._updateParams(r.typeahead("val"),a),t._searchAnalytics()):$(r).focus()},_updatePredictivParams:function(){var e=$(this.predictivSearch).val().trim(),t=$(this.searchForm),a=t.data("action");t.attr("action",a),$("input[name=q]").val(e)},_renderSuggestions:function(){var r=this,e=r.searchData||"",t=r.searchData.includeContentType?r.searchData.includeContentType.length:0,t={inputFont:parseInt($(r.searchInputField).css("font-size")),dropDownLabel:void 0!==e.includeContentType?e.includeContentType:"",searchWrapper:r.searchWrapper,inLabel:e.inLabel,searchInputField:r.searchInputField,clearSearch:r.clearSearch,customKeyword:!r.searchData.disableContentTypeFilter,hint:!r.searchData.disableAutoComplete,locale:$("input[name=Locale]").val(),brandName:$("input[name=BrandName]").val(),searchKeyword:r.searchKeyword.toLowerCase(),suggestionsLimit:r.searchData.autoSuggestResultCount,suggestionsLimitDefault:t,minLengthToTriggerAutoSuggest:r.searchData.minCharToTriggerAutoSuggest,autoSuggest:!r.searchData.disableAutoSuggest,isExternal:r.searchData.isExternal,selectCallback:function(e,t,a){r._updateParams(t,a.parents(r.searchForm)),e.searchKeyword=r.searchKeyword}};n.showSuggestions(t,r)},_updateParams:function(a,e){var r,i=this,t=i.searchData.includeContentType,e=e,n="";t.length?$(t).each(function(e,t){return-1!==a.indexOf(t.contentType)?(n="ContentType:"+t.contentType,i.searchKeyword=a.split(" "+i.searchData.inLabel+" "+t.contentType)[0],!1):(i.searchKeyword=a,void(n=""))}):(i.searchKeyword=a,n=""),t=$(i.defaultSettings.subBrand).find(".active").text().trim(),_.each(i.subBrandMap.subBrands,function(e,t){e.name.trim()===i.selectedSubBrand&&(r=e.subBrandsearchTag[0]?e.subBrandsearchTag[0].trim():"")}),$("input[name=q]").val(i.searchKeyword),$("input[name=fq]").val(n),$("input[name=sbn]").val(t),$("input[name=sbtg]").val(r),e.submit()},_searchAnalytics:function(){var e,t,a;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(e={},t=this.$el.find(".c-search-input-v2"),a=$(this.defaultSettings.subBrand).find(".active").text().trim(),1<t.length&&(t=t.eq(1)),c.trackComponentInfo(t,digitalData),e.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.siteSearch,eventLabel:a?a+" - "+this.searchKeyword:t.data("componentname")+" - "+this.searchKeyword,eventValue:1},e.category={primaryCategory:ctConstants.engagement},e.subcategory="Interest",digitalData.event.push(e))},_onLoadSelectedSubBrand:function(){var a=this,r=a.defaultSettings,i=a.getTemplate("search-input-list","partials/search-input-list.hbss");r.isPageLoad&&(a.selectedSubBrand=a.subBrandMap.selectedSubBrand.trim()),_.each(a.subBrandMap.subBrands,function(e,t){e.name.trim()===a.selectedSubBrand&&(""===a.subBrandMap.selectedSubBrandClass?$(r.searchInputWrapper).find("div[data-subbrandclass]").attr("class",""):$(r.searchInputWrapper).find("div[data-subbrandclass]").attr("class",e.class),e={searchHeadingText:e.searchHeadingText||a.searchData.searchHeadingText,searchLogoImage:{url:e.searchLogoImage.url||a.searchData.searchLogoImage.url,fileName:e.searchLogoImage.fileName||a.searchData.searchLogoImage.fileName,isNotAdaptiveImage:e.searchLogoImage.isNotAdaptiveImage||a.searchData.searchLogoImage.isNotAdaptiveImage,extension:e.searchLogoImage.extension||a.searchData.searchLogoImage.extension,altImage:e.searchLogoImage.altImage||a.searchData.searchLogoImage.altImage,title:e.searchLogoImage.title||a.searchData.searchLogoImage.title,path:e.searchLogoImage.path||a.searchData.searchLogoImage.path},searchInputPlaceholderText:e.searchInputPlaceholderText||a.searchData.searchInputPlaceholderText,ctaLabel:e.ctaLabel||a.searchData.ctaLabel,accessibilityFixFlag:a.searchData.accessibilityFixFlag},$(a.searchInputField).attr("placeholder",e.searchInputPlaceholderText),$(r.searchInputHeader).html(i(e)))})},_selectedSubBrand:function(e){var t=this,a=t.defaultSettings,e=$(e.currentTarget);$(a.subBrandEnabled).removeClass("active"),e.addClass("active"),t.selectedSubBrand=e.text().trim(),t.subBrandName=t.selectedSubBrand,a.isPageLoad=!1,t._onLoadSelectedSubBrand()},_openModal:function(e){e.preventDefault(),s.openOverlay(this.defaultSettings.takeoverSearchOverlay),$(".js-main-wrapper").removeClass("u-blur-background"),$(this.searchForm).hasClass("predictive-search-form")?setTimeout(function(){$(".predictive__search__form__textbox").focus()},200):setTimeout(function(){$(".c-search-input-v2-form__textbox").focus()},200),this._setOverlayTabbing()},_closeModal:function(e){e.preventDefault(),$(this.defaultSettings.searchInput).typeahead("val",""),s.closeOverlay(this.defaultSettings.takeoverSearchOverlay)},_setOverlayTabbing:function(){i&&i.off("keydown"),r&&r.off("keydown");var e=this.$el.find(".c-search-input-v2__search-overlay").find("input,button,a").not(":input[readonly]").filter(":visible");r=e.first(),i=e.last(),r.focus(),i.on("keydown",function(){9!==event.which||event.shiftKey||(event.preventDefault(),r.focus())}),r.on("keydown",function(){9===event.which&&event.shiftKey&&(event.preventDefault(),i.focus())})}})})});