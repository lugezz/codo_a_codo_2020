define(["commonService"],function(){"use strict";IEA.service("Analytics",function(t,e,a){function n(){return this}var r=null;return _.extend(n.prototype,{initialize:function(){return r=new IEA.commonService,this},trackComponentInfo:function(t,e,a){var n,o,i,r,c,s,d,p,u,l,v,m;t&&void 0!==e&&"undefined"!=typeof ctConstants&&(n=(m=$(t)).data("componentname"),o=m.data("component-variants"),i=m.data("component-positions"),r=m.data("component-experience-variant"),c=m.data("vendor-name"),s=m.data("promo-id"),d=m.data("campaign-usage-context"),p=m.data("tool-name"),l=t=u="",v=[],event&&event.target&&200===event.target.status?($("input:checked.c-form-radio__input.c-form-survey-field,input:checked.c-form-checkbox.c-form-survey-field,option:selected.c-form-dropdown.c-form-survey-field").not(":disabled").each(function(){u="","radio"===this.type?l+=$("[name="+this.name.split("answers")[0]+"question]")[0].value.split(":")[0].toLowerCase()+":"+$(this).parent().find(".c-form-radio__label").text().trim()+"|":"checkbox"===this.type?-1===v.indexOf(this.name.split("answers")[0]+"answers")&&(v.push(this.name.split("answers")[0]+"answers"),$("[name*="+this.name.split("answers")[0]+"answers]:checked").each(function(){u+=$(this).parent().find(".c-form-checkbox__label-copy").text().trim()+","}),u=u.slice(0,-1),l+=$("[name="+this.name.split("answers")[0]+"question]")[0].value.split(":")[0].toLowerCase()+":"+u+"|"):"option"===this.tagName.toLowerCase()&&(l+=$("[for="+this.parentElement.name+"]").text().split(":")[0].toLowerCase()+":"+this.text+"|")}),l=l.slice(0,-1)):event&&event.target&&event.target.type&&$(event.target).hasClass("c-form-survey-field")&&("radio"===(m=event.target.type)?(u=$(event.target).parent().find(".c-form-radio__label").text().trim(),t=$("[name="+event.target.name.split("answers")[0]+"question]")[0].value):"checkbox"===m?($("[name*="+event.target.name.split("answers")[0]+"answers]:checked").each(function(){u+=$(this).parent().find(".c-form-checkbox__label-copy").text().trim()+"|"}),u=u.trim().slice(0,-1),t=$("[name="+event.target.name.split("answers")[0]+"question]")[0].value):"select-one"===m&&(u=event.target.options[event.target.options.selectedIndex].text,t=$("[for="+event.target.id+"]").text()),l=(t?t.split(":")[0].toLowerCase():"")+" : "+(u?u.toLowerCase():"")),e.component=[],e.component.push({componentInfo:{componentID:n,name:n,experienceVariant:r||"default"},attributes:{brandOptin:a||"",position:i,componentVariant:o,reviewVendorName:c||"",promoCreative:s||"",promoID:s||"",promoName:s||"",promoPosition:i,campaignWorkflow:d||"",toolName:p||c||"",surveyQuesAns:l}}))},_trackFormSubmit:function(t,e,a){var n,o;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(digitalData.form={field:{}},e&&(digitalData.form.field=e),$(".form-filtered-survey").length?this._trackSurveyResponse("Survey Submitted"):(n={},o=location.pathname,e=$(".c-form-copy-content__headline:first").text(),o=o.substring(o.lastIndexOf("/")+1,o.lastIndexOf(".")),o=""===e?o:e,e=t.data("form-type")?t.data("form-type"):o,o=t.attr("id"),this.trackComponentInfo(t,digitalData),n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.forms,eventLabel:e+" - "+o+" - Form Successfully Submitted",eventValue:1},n.category={primaryCategory:ctConstants.engagement},n.subcategory="Lead",a&&(n.eventInfo.eventLabel="Registration-"+a),digitalData.event.push(n)))},_ctTag:function(t,e){var a,n,o,i,r,c,s,d;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(a={},d="",s="cookieq.com/YouTube"===t.videoPlayer.domain?(n="youtube",o=t.player.data("video-id")||t.videoPlayer.videoId,t.hasOwnProperty("autoplay")?t.autoplay:t.videoPlayer.autoplay||t.player.data("video-autoplay")):(n=t.player.data("video-source")||t.videoPlayer.videoSource||t.videoPlayer.a.dataset.videoSource,o=t.player.data("video-id")||t.videoPlayer.videoId||t.videoPlayer.a.dataset.videoId,t.videoPlayer.autoplay||t.player.data("video-autoplay")),d="vimeo"===n?t.videoPlayer.attr("video-title")?t.videoPlayer.attr("video-title"):"":(n=n||"youtube",void 0!==t.videoPlayer.getVideoData?t.videoPlayer.getVideoData().title:""),digitalData.video=[],digitalData.video.push({videoId:o,videoName:d}),r={primaryCategory:ctConstants.engagement},c="Interest",1===t.data||"play"===t.data?((i=s?ctConstants.videoAutoPlays:ctConstants.videoPlays)===ctConstants.videoAutoPlays&&(a.attributes={nonInteractive:{nonInteraction:1}},r={primaryCategory:ctConstants.custom},c="Read"),e()):0!==t.data&&"finish"!==t.data||(i=ctConstants.videoCompletes),a.eventInfo={type:ctConstants.trackEvent,eventAction:i,eventLabel:n+" - "+d+" - "+o,eventValue:1},a.category=r,a.subcategory=c,digitalData.event.push(a))},trackProductInfo:function(t,e,a,n){var o;t&&void 0!==a&&"undefined"!=typeof ctConstants&&(o=this.getAwards(t),a.product.push({productInfo:{productID:e.data("product-id"),productName:e.data("product-name"),price:n&&n.price?n.price:e.data("product-price")?e.data("product-price"):"",quantity:n&&n.quantity?n.quantity:e.data("product-quantity")?e.data("product-quantity"):"",sku:void 0!==e.data("product-variant")?e.data("product-variant"):""},attributes:{productPosition:void 0!==e.data("index")?e.data("index"):1,productAward:o,productFindingMethod:(t.data("componentname")?t:t.parents("[data-componentname]")).data("componentname"),productBrand:e.data("product-brand")},category:{primaryCategory:void 0!==e.data("product-category")?e.data("product-category"):""}}))},getAwards:function(t){var e=[];return t.find("[data-award-list]").length?e=t.find("[data-award-list]").data("award-list").split("|"):t.find(".c-award-name").each(function(){e.push($(this).text())}),_.without(e,"")},trackShopNow:function(t,e,a){var n,o,i;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(n={},i=(o=e).data("product-name"),this.trackComponentInfo(t,digitalData),this.trackProductInfo(t,o,digitalData),n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.purchase,eventLabel:"Online - "+i,eventValue:1},n.category={primaryCategory:ctConstants.conversion},n.subcategory="Lead",digitalData.event.push(n),a&&"etale"===a.serviceProviderName&&this.etaleTracking(t,e,a))},trackIframeMethod:function(t,e,a){var n=this,o=$(e).data("quick-view")?$(e).find("iframe"):".constantco-widget iframe";setTimeout(function(){require(["iframetracker"],function(){a.$el.find(o).iframeTracker({blurCallback:function(){n.trackShopNow(t,e)},overCallback:function(t){this._overId=$(t).attr("id")},outCallback:function(t){this._overId=null},_overId:null})})},900)},etaleTracking:function(t,a,n){"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(this.trackProductInfo(t,a,digitalData),require(["postmessage"],function(){$.receiveMessage(function(t){var e;-1!==n.serviceURL.indexOf(t.origin)&&(e={},void 0!==(t=JSON.parse(t.data).retailer)&&(e.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.retailerClick,eventLabel:"Online - "+a.data("product-name")+" | "+t,eventValue:1},e.category={primaryCategory:ctConstants.conversion},e.subcategory="Lead",digitalData.event.push(e),"object"==typeof $BV&&$BV.SI.trackConversion({type:"BuyOnline",label:t,value:a.data("product-id")})))})}))},storeSearch:function(t,e,a){var n={};"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(this.trackComponentInfo(t,digitalData),this.trackProductInfo(t,e,digitalData),n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.storesearch,eventLabel:a,eventValue:1},n.category={primaryCategory:ctConstants.engagement},n.subcategory="Interest",digitalData.event.push(n))},trackCampaignSteps:function(t,e){var a,n=$(t).data("campaign-usage-context");n&&void 0!==e&&"undefined"!=typeof ctConstants&&(a={},this.trackComponentInfo(t,e),a.eventInfo={type:ctConstants.campstep,eventAction:ctConstants.campstep,eventLabel:n,eventValue:1},a.category={primaryCategory:ctConstants.engagement},a.subcategory="Interest",e.event.push(a))},trackProductBundling:function(t,e){var a,n,o,i;e.length&&"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(a={},n=[],o=[],i=[],this.trackComponentInfo(t,digitalData),e.length&&($.each(e,function(){n.push(this.id),o.push(this.productName),i.push(this.productCategory)}),n=n.join(" | "),o=o.join(" | "),i=i.join(" | ")),digitalData.product=[],digitalData.product.push({productInfo:{productID:n,productName:o},category:{primaryCategory:i}}),a.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.clicktopurchasebundle,eventLabel:"Online - "+n,eventValue:1},a.category={primaryCategory:ctConstants.conversion},a.subcategory="Win",digitalData.event.push(a))},trackPurchase:function(t,e,a){var n={};void 0!==a&&"undefined"!=typeof ctConstants&&(this.trackComponentInfo(t,a),n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.purchase,eventLabel:"Online - "+e,eventValue:1},n.category={primaryCategory:ctConstants.conversion},n.subcategory="Lead",a.event.push(n))},trackEnhancedCheckoutPurchase:function(t,a,n){var e={},o=$.parseJSON(r.getLocalStorageItem("giftingCartData")),i=t.closest("body").hasClass("checkout-form-v2");void 0!==n&&"undefined"!=typeof ctConstants&&(n.product=[],this.trackComponentInfo(t,n),o.productInfo&&_.each(o.productInfo.products,function(t,e){n.product.push({productInfo:{productID:t.variantId,productName:t.title,price:t.price,brand:a,quantity:t.quantity},attributes:{productVariants:t.variant},category:{primaryCategory:""}})}),e.eventInfo={type:i?ctConstants.purchaseenhanced:ctConstants.checkoutenhanced},e.category={primaryCategory:ctConstants.conversion},e.subcategory="Win",n.event.push(e))},inputErrorTracking:function(t,e){var a;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(a={},this.trackComponentInfo(e,digitalData),a.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.inputerror,eventLabel:t,eventValue:1},a.category={primaryCategory:ctConstants.custom},a.subcategory="Error",digitalData.event.push(a))},customEventTracking:function(t,e){var a,n;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(a={},n=window.location.href,this.trackComponentInfo(t,digitalData),e="rememberme"===e?ctConstants.RememberMe:ctConstants.SignOut,a.eventInfo={type:ctConstants.trackEvent,eventAction:e,eventLabel:n,eventValue:1},a.category={primaryCategory:ctConstants.custom},a.subcategory="Interest",digitalData.event.push(a))},trackPricespiderEvents:function(t,e){var a;if("undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants){try{a=JSON.parse(localStorage.pricespiderComponentInfo)}catch(t){a={}}digitalData.component=[],digitalData.component.push({componentInfo:{componentID:a.componentName||"",componentName:a.componentName||""},attributes:{position:a.componentPosition||"",listPosition:a.componentPosition||"",componentVariant:a.componentVariation||""}});var n={};switch(t){case"wtb_open":digitalData.product=[],digitalData.product.push({productInfo:{productID:e.SKU||"",productName:e.productName||"",price:e.price||"",brand:e.brandName||"",quantity:""},category:{primaryCategory:e.productCategory||""},attributes:{productVariants:"",listPosition:""}}),n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.purchase,eventLabel:e.productName||"",eventValue:1},n.category={primaryCategory:ctConstants.conversion},n.subcategory="Lead";break;case"wtb_redirect":digitalData.product=[],digitalData.product.push({productInfo:{productID:e.SKU||"",productName:e.productName||"",price:e.price||"",brand:e.brandName||"",quantity:e.size||""},category:{primaryCategory:e.productCategory||""},attributes:{productVariants:e.size||"",listPosition:""}}),n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.retailerClick,eventLabel:e.productName+"|"+e.sellerName,eventValue:1},n.category={primaryCategory:ctConstants.conversion},n.subcategory="Lead";break;case"wtb_selector":n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.filter,eventLabel:e.size,eventValue:1},n.category={primaryCategory:ctConstants.engagement},n.subcategory="Interest";break;case"wtb_directions":n.eventInfo={type:ctConstants.trackEvent,eventAction:ctConstants.linkClick,eventLabel:a.componentName+"-"+e.productName+"|"+(e.sellerName||"not set")+"-"+(e.storePostalCode||"not set"),eventValue:1},n.category={primaryCategory:ctConstants.engagement},n.subcategory="Read"}digitalData.event.push(n)}},trackListingPromotion:function(t,e){var a,n;"undefined"!=typeof digitalData&&"undefined"!=typeof ctConstants&&(a={},n=t,t=$(n).parents("[data-role]").find("[data-component-variants]"),digitalData.promotion=[],digitalData.promotion.push({promotionInfo:{promotionId:$(n).find("a").attr("href"),promotionName:$(n).find("img").attr("alt")}}),e&&"view"===e&&(digitalData.component.push({componentInfo:{componentID:t.data("componentname"),componentName:t.data("componentname")},attributes:{position:t.data("componentPositions"),componentVariant:t.data("componentVariants")}}),a.eventInfo={type:ctConstants.promotionView},a.category={primaryCategory:ctConstants.custom},a.subcategory="Load",a.attributes={nonInteractive:{nonInteraction:1}}),digitalData.event.push(a))}}),n})});