/* Version=6.6.14,Timestamp=2020-12-24T09:28:36.549Z */define("page-listing-v2",["commonService","listing","lazyLoadService","analytics"],function(){"use strict";return IEA.module("UI.page-listing-v2",function(e,t,i){var g=null,d=null,n=null,c=null,a=null;_.extend(e,{defaultSettings:{searchWrapper:".c-page-listing-v2__wrapper",filterBlock:".c-page-listing-v2-filter__wrapper",filterWrapper:".c-listing-filter__filter, .js-filter-item",filterContainer:".c-page-listing-v2-filter__container",template:"partials/page-listing-v2-page.hbss",templateClickable:"partials/page-listing-v2-page-clickable.hbss",paginationTemplate:"pagination/defaultView.hbss",filterTemplate:"partials/listing-v2-filters.hbss",pageListingList:".c-page-listing-v2-listing__list",paginationBtn:".js-btn-pagination",pagination:".c-page-listing-v2-pagination",paginationContainer:".js-page-listing-v2-pagination",filterCount:".js-filter-count",loadmoreWrapper:".c-page-listing-v2__loadmore",loadmoreBtn:".js-btn-loadmore",ctaAnchor:".c-page-listing-v2-listing-item-cta__anchor",isPageLoad:!0,preloader:".c-page-listing-v2__loadmore .o-preloader",preloaderContent:".o-preloader--content",startPageNum:1,startIndex:1,pageNum:1,pageNavCount:5,filterBlockWrapper:".js-filter__wrapper",filterCollapsedCl:"c-filters-collapsed",filtersCollapsibleWrapper:".c-filters-collapsible",filtersCollapsedWrapper:".c-filter-collapsed",filtersCollapsedCl:"c-filter-collapsed",showHideFilterCl:".js-filter-showhidebtn",showHideFilterOptionsCl:".js-filter-showhidemore",hiddenCl:"c-hidden",filterBtnsWrapper:".c-product-listing-v2-filter__block-filterbtns",enableHistory:!0,urlSeprator:"~"},events:{"change .c-listing-filter__filter":"_filterChangeHandler","click .js-btn-loadmore":"_loadMorehandler","click .js-btn-pagination":"_paginationHandler","click .js-filter-showhidebtn":"_toggleFilterOptions","click .js-apply-filters":"_filterApplyHandler","click .js-clear-filters":"_filterClearHandler","click .js-filter-showhidemore":"_filterShowHideMoreHandler","click .js-product-listing__list-item":"_setValueToSessionStorage"},initialize:function(e){this._super(e),g=new IEA.commonService,d=new IEA.Listing,n=new IEA.LazyLoad,a=new IEA.Analytics,this.triggerMethod("init")},render:function(){return this.$el.html(this.template(this.getModelJSON())),!1===this._isEnabled&&(this.enable(),this._isEnabled=!0),this.triggerMethod("render"),this},enable:function(){var e=this;this.triggerMethod("beforEnable"),this.componentJson=this.getModelJSON().pageListingV2,this.pageNum=this.defaultSettings.pageNum,this.pagination=this.$el.find(this.defaultSettings.pagination),this.loadmoreWrapper=this.$el.find(this.defaultSettings.loadmoreWrapper),this.preloaderContent=this.$el.find(this.defaultSettings.preloaderContent),this.isPageLoad=this.defaultSettings.isPageLoad,this.startIndex=this.defaultSettings.startIndex,this.pageScroll=!1,this.selectedFiltersIndex=0,this.activeState=!1,this.listingResponse=!0,this.filterBlock=this.$el.find(this.defaultSettings.filterBlock),this.filterBlockWrapper=this.$el.find(this.defaultSettings.filterBlockWrapper),this.filtersCollapsibleWrapper=this.$el.find(this.defaultSettings.filtersCollapsibleWrapper),this.showHideFilterCl=this.$el.find(this.defaultSettings.showHideFilterCl),this.showHideFilterOptionsCl=this.$el.find(this.defaultSettings.showHideFilterOptionsCl),this.filterBtnsWrapper=this.$el.find(this.defaultSettings.filterBtnsWrapper),this.filterId="c"+this.componentJson.componentPosition+"_fl",this.urlSeprator=this.defaultSettings.urlSeprator,this.defaultSettings.enableHistory&&(this.pushHistory=!(1<window.performance.navigation.type),this.isHistoryPop=!1,g.historyPopStateBind(this.historyBackHandler,this)),this.componentJson.filterConfig.showFirstFilterCategory&&d._filtersViewHandler(this),this.$el.find(this.defaultSettings.loadmoreBtn).length&&_.throttle(d.handleLoadMore(this),250),this._renderPagination(this.componentJson.totalCount),""!==window.location.search&&this.defaultSettings.enableHistory&&($(e.preloaderContent).removeClass("hidden"),d.getUrlParameter(e.filterId)||(this.activeState=!0),this.historyFilterHandler(this,!0)),this._initiateLazyLoad(),e.componentJson.favouritesEnabled&&require(["favourites"],$.proxy(e._favRequireCallback,e)),g.listenEvent("onPromoView",function(e,t){a.trackListingPromotion(t.ref,"view")}),n.promoInView(!0,e.$el),this.triggerMethod("enable")},_favRequireCallback:function(){var t,i,n,a,o=this,r=o.defaultSettings,s="",e={},l="";c=new IEA.Favourites(o.componentJson),"favoritesList"===o.componentJson.generalConfig.buildNavigationUsing&&!o.listingDOMInjected&&o.listingResponse&&(o.componentJson.generalConfig.buildNavigationUsing="",JSON.parse(g.getLocalStorageItem("favourites-"+o.componentJson.brandName+"-"+o.componentJson.locale)).articleIds.forEach(function(e){l+=e+","}),l=l.slice(0,-1),e.queryParams=l,e.queryParams&&(e.queryParams="?"+o.componentJson.filterConfig.favouriteParamName+"="+e.queryParams),e.servletUrl=o.componentJson.filterConfig.ajaxURL,e.onCompleteCallback=function(e){o.listingResponse=!0,(t=JSON.parse(e)).data.pageListingV2.pages.length?("defaultView"===o.componentJson.componentVariation?i=o.getTemplate("page-listing-v2-page",r.template):n=o.getTemplate("page-listing-v2-page-clickable",r.templateClickable),a=o.getTemplatePath(i,n),t.data.pageListingV2.pages.forEach(function(e){e.args=[],e.args.push(o.componentJson),s+=a(e)}),$(r.pageListingList).html(s),o.componentJson.generalConfig.buildNavigationUsing="favoritesList",c.initialize(o.componentJson)):($(".o-preloader--favorites").addClass("hidden"),$(".no-data-favourite-cta").removeClass("hidden"))},e.onErrorCallback=function(e){o.listingResponse=!0},g.getDataAjaxMethod(e))},_getServiceQueryParams:function(){d.setFilterQueryParams(this)},_initiateLazyLoad:function(){},_populateData:function(){var t=this,e={},i="";e.queryParams=d.setFilterQueryParams(t),t.componentJson&&t.componentJson.favouritesEnabled&&t.componentJson.generalConfig&&"favoritesList"===t.componentJson.generalConfig.buildNavigationUsing&&(JSON.parse(g.getLocalStorageItem("favourites-"+t.componentJson.brandName+"-"+t.componentJson.locale)).articleIds.forEach(function(e){i+=e+","}),(i=i.slice(0,-1))&&(e.queryParams?e.queryParams+="&"+t.componentJson.filterConfig.favouriteParamName+"="+i:e.queryParams="?"+t.componentJson.filterConfig.favouriteParamName+"="+i)),e.servletUrl=t.componentJson.filterConfig.ajaxURL,e.onCompleteCallback=function(e){t.listingResponse=!0,e&&(e=$.parseJSON(e),t._updatePageListing(e.data,e.data.pageListingV2.totalCount),!g.getSessionStorageItem("palV2PageNum")||1!==window.performance.navigation.type&&0!==window.performance.navigation.type||g.removeSessionStorageItem("palV2PageNum"),t.pushHistory=!0,t.listingDOMInjected=!0)},e.onErrorCallback=function(e){t.listingResponse=!0},t.listingResponse&&(t.listingResponse=!1,g.getDataAjaxMethod(e))},_filterChangeHandler:function(e){d.filtersHandler(e,this)},_updatePageListing:function(e,t){var i,n,a,o=this,r=$(e.pageListingV2.pages),s=e.pageListingV2,l=o.defaultSettings,p="";"defaultView"===o.componentJson.componentVariation?i=o.getTemplate("page-listing-v2-page",l.template):n=o.getTemplate("page-listing-v2-page-clickable",l.templateClickable),a=o.getTemplatePath(i,n),r.each(function(e,t){t.args=[],t.args[0]=s,p+=a(t)}),o.componentJson.totalCount=t,o.$el.find(l.filterCount).text(t),$(o.preloaderContent).addClass("hidden"),o.$el.find(l.preloader).addClass("hidden"),1<o.pageNum&&"infiniteScroll"===o.componentJson.pagination.paginationType?o.$el.find(l.pageListingList).append(p):o.$el.find(l.pageListingList).html(p),d.updateFilters(o,e.pageListingV2),o.$el.find(l.ctaAnchor).text(o.componentJson.generalConfig.ctaLabelText),g.getSessionStorageItem("palV2PageNum")||(d.updateFilters(o,e.pageListingV2),e=d.setFilterQueryParams(o,"history"),o.pushHistory&&o.defaultSettings.enableHistory&&(o.isHistoryPop=!1,g.historyPushState({},null,e)),l.enableHistory&&o.historyFilterHandler(o,!1)),o._renderPagination(t),o._initiateLazyLoad(),c&&c.initialize(o.componentJson)},_renderPagination:function(e){var t=this.isPageLoad,i=this.componentJson.pagination;d.generatePagination(e,this,t,i)},_updateParamsOnPageScroll:function(e){var t=this.componentJson.filterConfig.itemsPerPage;this.pageScroll=e>t*this.pageNum},_loadMorehandler:function(e){var t=this,i=$(e.currentTarget),n=t.defaultSettings;e.preventDefault(),t.pageScroll=!1,t.pageNum++,i.fadeOut(500),t.$el.find(n.preloader).removeClass("hidden"),t._populateData()},_paginationHandler:function(e){var t=this,i=$(e.currentTarget);if(i.hasClass("o-btn--disabled")||i.hasClass("o-btn--active"))return e.preventDefault(),!1;$(t.preloaderContent).height($(t.productList).height()).removeClass("hidden").show(),g.animate("html, body",{scrollTop:$(t.$el).offset().top},500),t.startIndex=t.startIndex+t.componentJson.pagination.itemsPerPage,t.isPageLoad=!1,d.pagination(t.defaultSettings.paginationBtn,i,t),t._populateData()},getTemplatePath:function(e,t){t="defaultView"===this.componentJson.componentVariation?e:t;return t},_setValueToSessionStorage:function(){var e,t;this.$el.find(this.defaultSettings.listingItem).closest(this.defaultSettings.searchWrapper).find(".c-page-listing-v2-filter .c-listing-v2-filter__dropdown").each(function(){e=$(this).prop("name"),t=$(this).find("option:selected").val(),g.setSessionStorageItem(e,t)}),g.setSessionStorageItem("palV2PageNum",this.pageNum)},_toggleFilterOptions:function(e){e.preventDefault();e=$(e.currentTarget);d._toggleFilterOptions(this,e)},_filterApplyHandler:function(){d._filterApplyHandler(this)},_filterClearHandler:function(){d._filterClearHandler(this)},_filterShowHideMoreHandler:function(e){e.preventDefault();e=$(e.currentTarget);d._filterShowHideMoreHandler(this,e)},getQuery:function(e,t){return"sort"===e?t.componentJson.sortConfig?g.getQueryParams("st",!0):"":g.getQueryParams(t.filterId,!0,t.urlSeprator)},historyBackHandler:function(e,t){var i=d.getUrlParameter(t.filterId);t.isHistoryPop=!!e,t.pushHistory=!e,t.activeState=!1,t.historyFilterHandler(t,!0),i||t._populateData()},historyFilterHandler:function(n,a){var o=n.getQuery("filter",n),r=n.getQuery("sort",n),s=n.$el.find(n.defaultSettings.filterWrapper).not(".c-page-listing-v2-sort__dropdown"),t=n.$el.find(".c-listing-filter__filter.c-page-listing-v2-sort__dropdown"),l=a,p=!1,g=n.lastNonEmptyIndex(o),g=d.validateTriggerPoint(g,o,s);o.length?(_.each(o,function(e,i){_.each(s,function(e,t){i===t&&(i===g&&l?p=a=!0:a=!1,n.selectFilter($(e),o[t],a,n))})}),_.each(r,function(e,i){_.each(t,function(e,t){i===t&&(p&&(a=!1),n.selectFilter($(e),r[t],a,n))})})):($(n.preloaderContent).addClass("hidden"),_.each(s,function(e,t){a&&t+1===s.length?p=a=!0:a=!1,n.selectFilter($(e),"",a,n)}),_.each(t,function(e,t){a&&p&&(a=!1),n.selectFilter($(e),"",a,n)}))},selectFilter:function(e,t,i,n){var a="object"==typeof e?e:$("[name="+e+"]"),e=a[0].tagName.toLowerCase(),o=""===t&&"select"===e?$.trim(a.find("option").first().text()):decodeURIComponent($.trim(t)),i=i;"select"===e?i?a.find("option").filter(function(e){return $.trim($(this).text()).toLowerCase()===o.toLowerCase()}).prop("selected",!0).change():a.find("option").filter(function(e){return $.trim($(this).text()).toLowerCase()===o.toLowerCase()}).prop("selected",!0):(e=$.trim(a.parents("label").text()).toLowerCase(),""!==o&&e===o.toLowerCase()?i?a.prop("checked",!0).change():a.prop("checked",!0):a.prop("checked",!1))},lastNonEmptyIndex:function(e){for(var t=e.length;t--;)if(""!==e[t])return t;return-1}})})});